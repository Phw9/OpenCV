# Table of Contents

- [크기 불변 특징점 알고리즘](#크기-불변-특징점-알고리즘)
  - [SIFT](#SIFT)
  - [SURF](#SURF)
  - [KAZE](#KAZE)
  - [ORB](#ORB)

- [OpenCV 특징점 검출과 기술](#OpenCV-특징점-검출과-기술)


---

## 크기 불변 특징점 알고리즘

코너는 영상이 회전되어도 여전히 코너로 검출된다. 그러므로 코너는 회전 불변 특징점이라고 할 수 있다. 그러나 영상의 크기가 변경될 경우 코너는 더 이상 코너로 검출되지 않을 수 있다.

예를 들어 그림과 같이 크기가 확대되면 같은 크기의 사각형 안에서 코너보다는 에지에 가까운 형태로 관측 될 수 있다.

![캡처](https://user-images.githubusercontent.com/76188802/168242185-f3182fcd-5988-4dd7-9f4c-fde0fb852b0a.PNG)

크기가 다른 두 객체 영상에서 단순한 코너 점을 이용해 서로 같은 위치를 찾는 것에는 한계가 있어, 크기가 다른 영상에서도 지속적으로 검출될 수 있는 알고리즘 들이 있다.

---


### SIFT

SIFT는 크기 불변 특징 변환(Scale Invariant Feature Transform)의 약자이며, 2004년 캐나다의 브리티시 컬럼비아 대학교 로우(D. Lowe) 교수가 발표한 논문에 소개된 방법이다.

`SIFT 알고리즘은 영상의 크기 변화에 무관하게 특징점을 추출하기 위하여 입력 영상으로부터 스케일 스페이스(scale space)를 구성`한다. 스케일 스페이스는 `영상에 다양한 표준 편차를 이용한 가우시안 블러링을 적용하여 구성한 영상 집합`을 의미한다. 아래 레나 영상에 대해 스케일 스페이스를 구성한 예를 그림으로 보자.

![캡처](https://user-images.githubusercontent.com/76188802/168248926-61385428-293f-48e8-a177-bc6a65fd5855.PNG)

`여섯 개의 블러링된 영상이 스케일 스페이스를 구성한 결과이며, 이렇게 구성한 영상 집합을 옥타브(octave)`라고 한다. 이후 입력 영상의 크기를 가로, 세로 반으로 줄여 가면서 여러 옥타브를 구성한다. `SIFT 알고리즘에서 크기에 불변한 특징점을 검출할 때에는 인접한 가우시안 블러링 영상끼리의 차영상을 사용하며, 이를 DoG(Differece of Gaussian)영상` 이라고 한다. 그림 아래쪽에 나열한 영상이 레나 영상으로부터 구한 DoG 영상이다. 위 그림은 DoG 영상을 그레이스케일 영상 형식으로 보여주기 위해 각각의 차영상 픽셀 값에 128을 더해준 영상이다.

SIFT 알고리즘은 DoG 영상 집합에서 `인접한 DoG 영상을 고려한 지역 극값 위치를 특징점으로 사용하며, 이후 에지 성분이 강하거나 명암비가 낮은 지점은 특징점에서 제외`한다.

SIFT 알고리즘은 특징점을 검출하는 기능뿐만 아니라 `특징점 주변의 픽셀 값을 이용한 기술자(dscriptor)계산 방법`도 포함한다.
`특징점 기술자는 특징점 주변 영상의 특성을 여러 개의 실수 값으로 표현한 것을 의미하며, 특징 벡터(feature vector)`라고도 한다. 서로 같은 특징점에서 추출된 기술자는 실수 값 구성이 서로 일치한다. SIFT는 기본적으로 특징점 부근의 부분 영상으로부터 `그래디언트 방향 히스토그램을 추출해 기술자로 사용`한다. 특징점 근방으로부터 특징점의 주된 방향 성분을 계산하고, 이 방향 만큼 회전한 부분 영상으로부터 128개의 빈(bin)으로 구성된 그래디언트 방향 히스토그램을 계산한다. 각각의 빈 값은 float 자료형을 사용하며, 하나의 SIFT 특징점은 512byte 크기의 기술자로 표현된다.

SIFT 알고리즘은 영상의 크기, 회전 등의 변환뿐만 아니라 촬영 시점 변화에도 충분히 강인하게 동착하며, 잡음의 영향과 조명 변화가 있어도 특징점을 반복적으로 잘 찾아낸다. SIFT 알고리즘은 다양한 컴퓨터 비전 분야에서 적용되었고 특히 객체 인식, 파노라마 영상 이어붙이기, 3차원 장면 인식 등의 분야에서 효과적으로 사용됐다.


---

### SURF

2008년에 발표된 SURF(Speed-Up Robust Features) 알고리즘은 SIFT에서 사용한 `DoG 영상을 단순한 이진 패턴으로 근사화하여 속도를 향상`시켰다.


ref) H. Bay, A. Ess, T. Tuytelaars, and L. V. Gool, “SURF: Speeded Up Robust Features,” Computer Vision and Image Understanding (CVIU), vol. 110, no. 3, pp. 346-359, 2008.

---

### KAZE

2012년에 발표된 KAZE 알고리즘은 `가우시안 함수 대신 비등방성 확산 필터(nonlinear diffusion filter)를 이용해 비선형 스케일 스페이스를 구축하여 특징점을 검출`한다. KAZE 알고리즘은 객체의 윤곽을 잘 보전함으로써 블러링, 크기 및 회전 변환, 잡음 등의 영향으로 변형된 영상에서 같은 특징점을 반복적으로 찾아내는 성능이 뛰어나다.




---

### ORB

SIFT, SURF, KAZE 방법은 스케일 스페이스를 구성하는 등 복잡한 연산을 수행해야 하기 때문에 실시간 응용에서 사용하기 어렵다는 단점이 있다. 또한, 이들 특징점 알고리즘에 의해 만들어지는 기술자는 128개 또는 64개의 실수 값으로 구성되어 있어서 메모리 사용량이 많고 특징점 사이의 거리 계산도 오래 걸릴 수 있다는 단점이 있다. 그래서 2010년 전후로는 특징점 검출이 매우 빠르고 이진수로 구성된 기술자를 사용하는 알고리즘이 발표되기 시작했다.

그중 2011년 발표된 ORB(Oriented FAST and Rotated BRIEF) 알고리즘은 당시 OpenCV를 관리하던 연구소에서 개발한 방법으로서, ⑴ SIFT와 SURF를 대체하기에 좋은 알고리즘이다. `ORB 알고리즘은 기본적으로 FAST 코너 검출 방법을 이용해 특징점을 추출`한다. 다만 `기본적인 FAST 알고리즘은 영상의 크기 변화에 취약하기 때문에 ORB 알고리즘은 입력 영상의 크기를 점진적으로 축소한 피라미드 영상을 구축하여 특징점을 추출`한다. 그리고 `각 특징점에서 주된 방향 성분을 계산하고, 방향을 고려한 BRIEF 알고리즘으로 이진 기술자를 계산`한다.

ORB에서 사용한 BRIEF(Binary Robust Independent Elementary Features)는 순수하게 특징점 기술자만을 생성하는 알고리즘이다⑵. BRIEF는 특징점 주변의 픽셀 쌍을 미리 정하고, 해당 픽셀 값 크기를 비교하여 0 또는 1로 특징을 기술한다. 두 점 x와 y에서의 픽셀 값 크기 비교 테스트는 τ는 다음과 같이 정의 한다.

![캡처](https://user-images.githubusercontent.com/76188802/168259980-d18754b2-5b3f-4a4e-a0d5-40396e818d9b.PNG)

예를 들어 아래 그림과 같이 특징점 p 주변에 a, b, c 점을 미리 정의하고, τ(a,b), τ(b,c), τ(c,a)를 구하면 이진수 0b110을 얻을 수 있다. 이진수 0b110은 b점이 a보다 밝고, c점이 b보다 밝고, a점은 c보다 어둠다는 정보를 표현한다. 이처럼 특징점 주변 정보를 이진수 형태로 표현하는 기술자를 이진 기술자(binary descriptor)라고 한다.

![캡처](https://user-images.githubusercontent.com/76188802/168260678-0d3c82f5-f170-4d9f-9aa4-a9c71b118866.PNG)


ORB 알고리즘은 

1. FAST 기반의 방법으로 특징점을 구한 후, 각 특징점에서 픽셀 밝기 값 분포를 고려한 코너 방향 성분을 계산한다.
2. 이 방향 성분을 이용하여 BRIEF 계산에 필요한 점들의 위치를 보정함으로써 회전에 불변한 BRIEF 기술자를 계산한다.

ORB 알고리즘에서는 기본적으로 `256개의 크기비교 픽셀 쌍을 사용하여 이진 기술자를 구성하며, 결과적으로 하나의 특징점은 256비트로 표현`할 수 있다. SIFT와 SURF 기술자가 각각 512바이트, 256바이트를 사용하는 것에 비해 ORB는 32바이트의 크기로 특징점을 기술할 수 있어서 효율적이다.

이진 기술자로 표현된 특징점 사이의 거리 계산은 주로 해밍 거리(Hamming distance)방법을 사용한다. 해밍 거리는 이진수로 표현된 두 기술자에서 서로 값이 다른 비트의 개수를 세는 방식으로 계산한다. 해밍 거리 계산은 두 기술자의 비트 단위 배타적 논리합(XOR) 연산 후, 비트 값이 1인 개수를 세는 방식으로 빠르게 계산한다.

ORB 외에도 BRISK, AKAZE, FREAK 등의 이진 기술자를 사용하는 특징점 알고리즘이 있다.


ref) 
⑴ E. Rublee et al., “Orb: an efficient alternative to sift or surf,” IEEE International Conference on Computer Vision (ICCV), pp. 2564-2571. 2011.
⑵ M. Calonder, V. Lepetit, C. Strecha and P. Fua, “ BRIEF: Binary Robust Independent Elementary Features,” European Conference on Computer Vision (ECCV), pp. 778-792, September, 2010.

---



## OpenCV 특징점 검출과 기술


